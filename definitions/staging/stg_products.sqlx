config {
    type: "table",
    schema: constants.DATASET_STAGING,
    description: "Cleaned product data"
}

SELECT 
    product_id,
    TRIM(product_name) as product_name,
    TRIM(category) as category,
    cost_price,
    retail_price,
    retail_price - cost_price as margin,
    ROUND((retail_price - cost_price) / retail_price * 100, 2) as margin_percent,
    CURRENT_TIMESTAMP() as processed_at
FROM ${ref("raw_data", "products")}
WHERE cost_price > 0 
  AND retail_price > cost_price