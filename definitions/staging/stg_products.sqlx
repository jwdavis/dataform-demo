config {
    type: "table",
    schema: constants.DATASET_STAGING,
    description: "Cleaned product data"
}

SELECT
  product_id,
  TRIM(product_name) AS product_name,
  TRIM(category) AS category,
  cost_price,
  retail_price,
  retail_price - cost_price AS margin,
  ROUND((retail_price - cost_price) / retail_price * 100, 2) AS margin_percent,
  CURRENT_TIMESTAMP() AS processed_at
FROM
  ${ref("products")}
WHERE
  cost_price > 0
  AND retail_price > cost_price
